# OpenVPN Client Configuration — Roost Content Acquisition VPN
#
# PURPOSE: Content acquisition ONLY.
#
# This VPN is used exclusively for fetching content from source providers
# (M3U playlists, IPTV streams, VOD downloads). It routes only source
# provider IP ranges through the VPN tunnel.
#
# Subscriber delivery does NOT use this VPN. All subscriber traffic goes
# through Cloudflare CDN (zero-logging, edge-cached).
#
# DEPLOYMENT:
#   - Runs as a Docker container alongside the ingest service on the Roost VPS.
#   - Image: dperson/openvpn-client (or equivalent minimal Alpine-based image)
#   - The ingest Go service is configured to use the VPN interface (tun0) via
#     the ACQUISITION_VPN_IFACE env var.
#
# CREDENTIALS:
#   - VPN provider credentials in ~/.claude/vault.env (ROOST_VPN_USERNAME, ROOST_VPN_PASSWORD)
#   - Certificate files: infra/vpn/certs/ (gitignored — see .gitignore)
#   - auth-user-pass reads from /etc/openvpn/auth.txt (injected at runtime from vault)
#
# NEVER commit real credentials or certificate material to this repo.

client
dev tun
proto udp
nobind

# ---- Server -----------------------------------------------------------------
# Use your chosen VPN provider endpoint here.
# For content acquisition, a provider with stable IPs in the source region
# (typically US or EU) is preferred.
remote VPN_SERVER_PLACEHOLDER 1194
remote-random
resolv-retry infinite

# ---- Authentication ---------------------------------------------------------
# auth.txt format: first line = username, second line = password.
# Written at container startup from ROOST_VPN_USERNAME / ROOST_VPN_PASSWORD vault vars.
auth-user-pass /etc/openvpn/auth.txt

# ---- Certificate material ---------------------------------------------------
# These files are placed in /etc/openvpn/ by the Docker entrypoint.
# Source: infra/vpn/certs/ (gitignored, distributed out-of-band).
ca   /etc/openvpn/certs/ca.crt
cert /etc/openvpn/certs/client.crt
key  /etc/openvpn/certs/client.key
tls-auth /etc/openvpn/certs/ta.key 1

# ---- Routing ----------------------------------------------------------------
# CRITICAL: Do NOT set route-nopull. We use vpn-routing.sh to selectively
# route only content source IPs through the VPN. See vpn-routing.sh for
# the routing table setup.
#
# route-nopull is NOT set here because we need the VPN to establish a default
# route that vpn-routing.sh can then selectively override.

# ---- Privacy settings -------------------------------------------------------
# Do not send DNS queries through the VPN (use the Hetzner nameserver).
# This prevents DNS leaks that could expose content source lookups.
dhcp-option DNS 1.1.1.1

# Script hooks — vpn-routing.sh runs after tunnel comes up.
script-security 2
up /etc/openvpn/vpn-routing.sh
down /etc/openvpn/vpn-routing.sh

# ---- Keepalive / reconnect --------------------------------------------------
keepalive 10 60
persist-key
persist-tun
connect-retry 5
connect-retry-max 10

# ---- Cipher -----------------------------------------------------------------
cipher AES-256-GCM
auth SHA256
tls-version-min 1.2

# ---- Logging ----------------------------------------------------------------
# Minimal logging — do not log traffic (privacy).
verb 1
mute 20
