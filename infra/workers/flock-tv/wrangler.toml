# wrangler.toml — Cloudflare Workers config for Flock TV content serving.
# Phase FLOCKTV: three workers sharing the same R2 bindings.
# Deploy: wrangler deploy --config infra/workers/flock-tv/wrangler.toml
#
# Secrets (set via wrangler secret put):
#   FLOCK_JWT_SECRET — Ed25519 public key for subscriber JWT verification
#
# Account ID: 29537f934ea5d6cb4111472ff8728f91 (from existing worker config)

name = "flock-tv-content"
compatibility_date = "2024-01-01"
main = "content-serve.ts"

account_id = "29537f934ea5d6cb4111472ff8728f91"

# R2 bucket bindings — buckets must be created before first deploy.
# Run infra/r2/setup.sh to create all required buckets.
[[r2_buckets]]
binding = "FLOCK_CONTENT"
bucket_name = "flock-content"

[[r2_buckets]]
binding = "FLOCK_FAMILY_PRIVATE"
bucket_name = "flock-family-private"

[[r2_buckets]]
binding = "FLOCK_LIVE"
bucket_name = "flock-live"

# Routes: stream.yourflock.org serves all three content types.
[[routes]]
pattern = "stream.yourflock.org/content/*"
zone_name = "yourflock.org"

[[routes]]
pattern = "stream.yourflock.org/private/*"
zone_name = "yourflock.org"

[[routes]]
pattern = "stream.yourflock.org/live/*"
zone_name = "yourflock.org"

# FLOCK_JWT_SECRET is set via: wrangler secret put FLOCK_JWT_SECRET
# Do NOT put secret values in this file.
[vars]
CDN_ENV = "production"
